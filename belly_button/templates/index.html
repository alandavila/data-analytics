<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!--link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.css"-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!--link rel="stylesheet" href= {{ url_for( "static", filename="css/styles.min.css" ) }}-->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <title>Belly Button</title>
</head>
<body>
    <div class='container'>
      <div class="jumbotron text-center">
        <h1>Belly Button Biodiversity Dashboard</h1>
        <h2>Use the interactive charts below to explore de dataset</h2>
      </div>
      <div class='row'>
        <div class='col-md-3'>
          <div class='row'>
            <div class='col-md-12'>
              <form>
                <div class="form-group">
                    <label>Select Sample: </label>
                    <br>
                    <select  id="selDataset" onchange="optionChanged(this.value)" class="custom-select custom-select-md"></select>
                </div>
              </form>
              <script>
                function load_samples_dropdown(){
                  Plotly.d3.json('/names', function(error, response){
                    if (error) return console.warn(error);
                    for(var i = 0; i < response.length; i++){
                        Plotly.d3.select("#selDataset").append("option").attr("value",response[i]).text(response[i]);
                    }
                  })
                }
                load_samples_dropdown();

                function optionChanged(value){
                  console.log(value);
                  var url = '/metadata/' + value;
                  Plotly.d3.json(url, function(error, response){
                    if (error) return console.warn(error);
                    var table = Plotly.d3.select('#sample_table');
                    table.selectAll('tr').remove();
                    table.selectAll('td').remove();
                    table.selectAll('thead').remove();
                    table.append('thead').text('Sample Metadata')
                      .style('font-weight','bold');
                    for (var key in response) {
                      var val = response[key];
                      var row = table.append('tr');
                      row.append('td').text(key);
                      row.append('td').text(val);
                    }
                  })

                  var url = '/samples/' + value;
                  var values=[];
                  var otu_ids = [];
                  var otu_desc = [];
                  Plotly.d3.json(url, function(error, response){
                    if (error) console.warn(error);
                    console.log(response);
                    for(var i = 0;i<10;i++){
                      values.push(response[value][i]);
                      otu_ids.push(response['otu_id'][i]);
                    }
                  })

                  


                }

              </script>
            </div>
            <div class='col-md-12' >
              <table class="table table-striped">
                <tbody id='sample_table'>
                </tbody>
              </table>
            </div>
          </div>
          <div class='row'></div>
        </div>
        <div class='col-md-6' class='pie'></div>
        <div class='col-md-6'></div>
      </div>
      <div class='row'></div>
    </div>

</body>
</html>
